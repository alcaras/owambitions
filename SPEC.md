# Old World Ambition Viewer - Technical Specification

## Overview

A web-based viewer for Old World's ambition/goal system. The project consists of:
1. **Parser** - Extracts and transforms XML game data into JSON
2. **Viewer** - Static web app deployable to GitHub Pages

## Project Structure

```
owambitions/
‚îú‚îÄ‚îÄ Reference/                 # Game files (NOT committed to git)
‚îÇ   ‚îî‚îÄ‚îÄ XML/Infos/            # Source XML files
‚îú‚îÄ‚îÄ parser/                    # Parser scripts (committed)
‚îÇ   ‚îî‚îÄ‚îÄ parse.py              # Main parser script
‚îú‚îÄ‚îÄ viewer/                    # GitHub Pages deployable folder (committed)
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ style.css
‚îÇ   ‚îú‚îÄ‚îÄ app.js
‚îÇ   ‚îî‚îÄ‚îÄ data/
‚îÇ       ‚îî‚îÄ‚îÄ ambitions.json    # Generated by parser (committed)
‚îú‚îÄ‚îÄ SPEC.md                   # This file
‚îî‚îÄ‚îÄ .gitignore                # Excludes Reference/ folder
```

## Data Model

### Source Files (XML)

| File | Purpose | Size |
|------|---------|------|
| `goal.xml` | Main ambition definitions (328 entries) | 163 KB |
| `text-infos.xml` | Display names (multi-language) | 1.7 MB |
| `law.xml` | Law definitions for cross-reference | 51 KB |
| `tech.xml` | Technology definitions | 51 KB |
| `improvement.xml` | Improvements/wonders | 198 KB |
| `familyClass.xml` | Family class definitions | 27 KB |
| `specialist.xml` | Specialist definitions | 19 KB |
| `yield.xml` | Yield type definitions | - |

### Output Schema (JSON)

```json
{
  "version": "1.0",
  "generatedAt": "2024-01-11T...",
  "ambitionClasses": {
    "1": "Laws",
    "2": "Theologies",
    "3": "Cities",
    ...
  },
  "familyClasses": {
    "FAMILYCLASS_STATESMEN": { "name": "Statesmen", "icon": "..." },
    ...
  },
  "ambitions": [
    {
      "id": "GOAL_EPICS",
      "name": "Enact Epics",
      "nameRaw": "TEXT_GOAL_EPICS",
      "helpText": "...",
      "ambitionClass": 1,
      "ambitionClassName": "Laws",
      "minTier": 1,
      "maxTier": 2,
      "subjectWeight": 1000,
      "techPrereq": "TECH_...",
      "techObsolete": "TECH_RHETORIC",
      "requirements": {
        "type": "law",
        "law": "LAW_EPICS",
        "lawName": "Epics"
      },
      "familyClasses": ["FAMILYCLASS_ARTISANS"],
      "flags": {
        "victoryEligible": false,
        "blockComplete": false
      }
    },
    ...
  ]
}
```

## Ambition Classes (31 Categories)

| Class | Name | Description |
|-------|------|-------------|
| 1 | Laws | Enacting specific laws or law counts |
| 2 | Theologies | Establishing specific theologies |
| 3 | Cities | City and connected city counts |
| 4 | Tribes | Fighting/clearing tribes |
| 5 | Production | Yield production (Food, Wood, Iron, Stone) |
| 6 | Stockpiles | Yield stockpiles (Civics, Training, Money) |
| 7 | Workers | Workers and rural improvements |
| 8 | Rural | Other rural improvements |
| 9 | Wonders | Specific wonder construction |
| 10 | Culture | Cultural cities and wonder counts |
| 11 | Rural Specialists | Farmers, miners, etc. |
| 12 | Urban Specialists | Acolytes, poets, etc. |
| 13 | Projects | Project completion |
| 14 | Diplomacy | Peace treaties, alliances |
| 15 | Religion | Founded, state religion, spread |
| 16 | Technology | Tech research, tech pairs |
| 17 | Kills | Combat kill counts |
| 18 | Promotions | Unit promotions, max level |
| 19 | Units | Specific unit type counts |
| 20 | Unique Units | Civilization-specific units |
| 21 | Leaders | Courtiers, governors, generals |
| 22 | Exploration | Land/water discovery |
| 23 | Caravans | Trade routes |
| 24 | Luxuries | Luxury distribution |
| 25 | Conquest | City capture/recapture |
| 26 | Population | Population thresholds |
| 27 | Urban | Urban improvements (non-military) |
| 28 | Religious Buildings | Shrines, temples |
| 29 | Urban Development | Urban tiles and improvements |
| 30 | Espionage | Agent networks |
| 31 | Defense | Defensive projects, militia |
| 39 | Repairs | Infrastructure repairs |
| 40 | Lifestyle | Lavish lifestyle projects |

## Requirement Types

The parser normalizes various goal conditions into requirement objects:

### Simple Requirements
- `law` - Enact a specific law
- `theology` - Establish a specific theology
- `cities` - Have N cities
- `connectedCities` - Have N connected cities
- `population` - Reach N population
- `legitimacy` - Reach N legitimacy
- `wonders` - Build N wonders
- `laws` - Enact N total laws
- `stateReligion` - Have a state religion

### Count Requirements (with targets)
- `yieldProduced` - Produce N of yield type
- `yieldStockpile` - Have N in stockpile
- `yieldRate` - Produce N per turn
- `improvements` - Build N of improvement type
- `improvementClass` - Build N from improvement class
- `specialists` - Train N specialists of type
- `units` - Train N units of type
- `techs` - Research specific techs
- `techCount` - Research N techs
- `diplomacy` - Achieve N diplomatic states
- `kills` - Kill N units/tribes

### Complex Requirements
- `subGoals` - Complete sub-goals
- `statCount` - Track game statistics

## Parser Implementation

### Language
Python 3 (widely available, good XML support)

### Dependencies
- `xml.etree.ElementTree` (standard library)
- `json` (standard library)

### Algorithm

```
1. Parse goal.xml -> extract all goal entries
2. Parse text-infos.xml -> build text lookup map
3. Parse reference files (law.xml, tech.xml, etc.) -> build lookup maps
4. For each goal:
   a. Extract base fields (id, class, tiers, weight)
   b. Resolve text references -> human-readable names
   c. Normalize requirements into structured format
   d. Resolve cross-references (law names, tech names, etc.)
5. Output ambitions.json
```

### Text Resolution

Text entries in `text-infos.xml` use a `link()` syntax:
- `link(LAW_EPICS)` -> "Epics"
- `link(TECH_FORESTRY)` -> "Forestry"

The parser should:
1. Extract raw text for primary language (en-US)
2. Resolve link() references to human-readable names
3. Strip remaining markup for clean display

## Viewer Implementation

### Technology
- Pure HTML/CSS/JavaScript (no build step)
- No external dependencies for easy GitHub Pages hosting

### Features

1. **Ambition List**
   - Sortable by class, tier, name
   - Filterable by class, tier range, family preference
   - Search by name

2. **Ambition Detail**
   - Full name and description
   - Tier range display
   - Requirements breakdown
   - Family class preferences
   - Tech prerequisites/obsolescence

3. **Class Browser**
   - Group ambitions by class
   - Class descriptions

4. **Family Filter**
   - Show ambitions preferred by specific families

### UI Design

```
+------------------------------------------+
| Old World Ambition Viewer                |
+------------------------------------------+
| [Search...] [Class ‚ñº] [Tier ‚ñº] [Family ‚ñº]|
+------------------------------------------+
| CLASS: Laws (12)                         |
|   ‚îú‚îÄ Enact Epics          [T1-2] ‚öíÔ∏è      |
|   ‚îú‚îÄ Enact Exploration    [T1-2] üèπ      |
|   ‚îî‚îÄ ...                                 |
| CLASS: Theologies (8)                    |
|   ‚îú‚îÄ Establish Veneration [T3-4] üëë‚õ™    |
|   ‚îî‚îÄ ...                                 |
+------------------------------------------+
```

### Data Loading
- Fetch `data/ambitions.json` on page load
- Render dynamically with JavaScript
- Cache in localStorage for offline use

## .gitignore

```
# Game files (copyrighted)
Reference/

# Python
__pycache__/
*.pyc

# OS
.DS_Store
```

## Build/Deploy Process

1. **Development**
   ```bash
   # Run parser (requires Reference/ folder)
   python parser/parse.py

   # Serve viewer locally
   cd viewer && python -m http.server 8000
   ```

2. **Deployment**
   - Push `viewer/` folder to GitHub
   - Enable GitHub Pages on `viewer/` directory
   - Site auto-deploys at `username.github.io/repo/`

## Open Questions

1. **Multi-language support?**
   - Currently spec assumes English only
   - Could include all languages in JSON for i18n

2. **DLC content?**
   - Some goals require DLC (GameContentRequired field)
   - Should these be marked/filtered?

3. **Icons/Graphics?**
   - Reference/Graphics/ has game assets
   - Copyright concerns for using in viewer?
   - Alternative: Use emoji or simple icons

4. **Scenario goals?**
   - Some goals are scenario-specific (bScenario flag)
   - Include or exclude?
